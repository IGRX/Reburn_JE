<view class="container">
  <!-- 加载中状态 -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text>加载中...</text>
  </view>

  <!-- 错误信息 -->
  <view class="error-container" wx:elif="{{errorMessage}}">
    <text class="error-message">{{errorMessage}}</text>
</view>

  <!-- 乐谱内容 -->
  <view class="score-container" wx:elif="{{score}}">
    <!-- 乐谱标题和信息 -->
    <view class="score-header">
      <view class="score-title">{{ score.Title || '未命名乐谱'}}</view>
      <view class="album-info">
        <view class="album-detail">
          <text>作者: </text>
          <block wx:if="{{score.Author && score.Author.length > 0}}">
            <text wx:for="{{score.Author}}" wx:key="*this" wx:for-item="author">{{author}}{{index < score.Author.length - 1 ? '、' : ''}}</text>
          </block>
          <text wx:else>未知作者</text>
        </view>
        <text class="album-detail">专辑: {{score.Album || '未知专辑'}}</text>
        <text class="album-detail" wx:if="{{score.Description}}">说明: {{score.Description}}</text>
      </view>
      <view class="score-info">
        <text class="score-uploader" wx:if="{{score.uploader}}">上传者: {{score.uploader}}</text>
        <text class="score-date" wx:if="{{score.uploadDate}}">上传日期: {{score.uploadDate}}</text>
      </view>
    </view>

    <!-- JE文本内容 -->
    <view class="score-content-card" wx:if="{{score.JeContent}}">
      <view class="content-title">JE谱</view>
      <view class="je-text">{{score.JeContent}}</view>
    </view>

    <!-- 文件内容 -->
    <view class="score-content-card" wx:elif="{{score.type !== 'je'}}">
      <view class="content-title">文件预览</view>

      <!-- 图片预览 -->
      <view wx:if="{{score.type === 'image'}}">
        <image class="preview-image" bindtap="onImageTap" src="{{score.url}}" mode="widthFix" show-menu-by-longpress="{{true}}"></image>
      </view>

      <!-- PDF预览，但是我更倾向于叫查看，因为微信自己不能直接开pdf -->
      <view wx:elif="{{score.type === 'pdf'}}">
        <view class="pdf-preview-container">
          <text class="pdf-preview-text">这是一个PDF文件，点击下方按钮在本地预览。</text>
          <button class="preview-btn" bindtap="onPdfTap">预览PDF</button>
        </view>
      </view>

      <!-- 其他文件类型 -->
      <view wx:else class="file-info">
        <text>文件名: {{score.name || '未知文件'}}</text>
        <text wx:if="{{score.size}}">大小: {{score.sizeText}}</text>
        <text class="unsupported-text">暂不支持预览此类型文件。</text>
      </view>
    </view>

    <!-- 无内容提示 -->
    <view class="no-content" wx:else>
      <text>此乐谱没有可显示的内容</text>
    </view>
  </view>
</view>