<view class="container">
  <!-- 页面标题 -->
  <view class="header">
    <view class="title">上传文件谱</view>
    <view class="subtitle">选择您的乐谱文件</view>
  </view>

  <!-- 文件选择器 -->
  <view class="file-section">
    <view class="file-header">
      <view class="file-title">选择文件</view>
    </view>
    
    <!-- 文件选择按钮 -->
    <view wx:if="{{!selectedFile}}" class="file-selector">
      <button class="select-file-btn" bindtap="chooseFile">
        <view class="btn-icon">📁</view>
        <view class="btn-text">选择乐谱文件</view>
      </button>
      <view class="file-info">
        <view class="file-limit">文件大小限制：10MB</view>
        <view class="file-formats">支持格式：PDF、JPG、PNG</view>
      </view>
    </view>

    <!-- 已选择文件 -->
    <view wx:else class="file-preview">
      <view class="file-info-card">
        <view class="file-icon">
          <image wx:if="{{selectedFile.type === 'image'}}" src="{{selectedFile.previewUrl}}" mode="aspectFit" class="file-thumbnail" />
          <view wx:else class="file-icon-placeholder">📄</view>
        </view>
        <view class="file-details">
          <view class="file-name">{{selectedFile.name}}</view>
          <view class="file-meta">
            <view class="file-size">{{selectedFile.sizeText}}</view>
            <view class="file-type">{{selectedFile.type.toUpperCase()}}</view>
          </view>
        </view>
        <view class="file-actions">
          <view class="action-btn" bindtap="previewFile">
            <view class="action-icon">👁️</view>
          </view>
          <view class="action-btn" bindtap="removeFile">
            <view class="action-icon">🗑️</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 元数据表单 -->
  <view class="metadata-section">
    <view class="section-title">乐谱信息</view>
    
    <!-- 标题 -->
    <view class="form-item">
      <view class="form-label">标题</view>
      <input 
        class="form-input" 
        placeholder="请输入乐谱标题" 
        value="{{metadata.title}}"
        bindinput="onTitleChange"
        maxlength="100"
      />
    </view>

    <!-- 作者 -->
    <view class="form-item">
      <view class="form-label">作者</view>
      <view class="authors-container">
        <view class="authors-list" wx:if="{{metadata.author.length > 0}}">
          <view class="author-tag" wx:for="{{metadata.author}}" wx:key="index">
            <text>{{item}}</text>
            <text class="delete-author" data-index="{{index}}" bindtap="removeAuthor">×</text>
          </view>
        </view>
        <input 
          class="form-input {{metadata.author.length > 0 ? 'has-authors' : ''}}" 
          placeholder="{{metadata.author.length > 0 ? '添加更多作者' : '请输入作者姓名，点击回车添加'}}" 
          value="{{currentAuthor}}"
          bindinput="onCurrentAuthorChange"
          bindconfirm="addAuthor"
          maxlength="50"
        />
      </view>
    </view>

    <!-- 专辑 -->
    <view class="form-item">
      <view class="form-label">专辑</view>
      <input 
        class="form-input" 
        placeholder="请输入专辑名称" 
        value="{{metadata.album}}"
        bindinput="onAlbumChange"
        maxlength="100"
      />
    </view>

    <!-- 封面选择 -->
    <view class="form-item">
      <view class="form-label">封面</view>
      <view class="cover-section">
        <view wx:if="{{!metadata.cover}}" class="cover-placeholder" bindtap="chooseCover">
          <view class="cover-icon">📷</view>
          <view class="cover-text">点击选择封面</view>
        </view>
        <view wx:else class="cover-preview" bindtap="chooseCover">
          <image src="{{metadata.cover}}" mode="aspectFill" class="cover-image" />
          <view class="cover-overlay">
            <view class="cover-change-text">更换封面</view>
          </view>
        </view>
      </view>
    </view>

    <!-- 描述 -->
    <view class="form-item">
      <view class="form-label">描述</view>
      <textarea 
        class="form-textarea" 
        placeholder="请输入乐谱描述或备注" 
        value="{{metadata.description}}"
        bindinput="onDescriptionChange"
        maxlength="200"
        auto-height
        show-confirm-bar="{{false}}"
      ></textarea>
    </view>
  </view>

  <!-- 操作按钮 -->
  <view class="action-section">
    <button class="action-btn preview-btn" bindtap="previewFile" disabled="{{!canPreview}}">
      <view class="btn-icon">👁️</view>
      <view class="btn-text">预览</view>
    </button>
    <button class="action-btn save-btn" bindtap="saveFile" disabled="{{!canSave}}">
      <view class="btn-icon">💾</view>
      <view class="btn-text">保存</view>
    </button>
  </view>
</view>
